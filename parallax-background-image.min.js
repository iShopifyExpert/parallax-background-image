(function(a){'use strict';function b(K,L=document){return'string'==typeof K?L.querySelector(K):K}function f(K,L=document){return K instanceof Element?[K]:Array.isArray(K)?K:('string'==typeof K&&(K=L.querySelectorAll(K)),Array.prototype.slice.call(K))}function g(K,L){return'string'==typeof L?h(L):h(L(K))}function h(K){return new Promise((L,M)=>{const N=document.createElement('img');N.onload=O=>{L(O.target)},N.onerror=O=>{M(O.error)},N.src=K})}function j(K){return K.match(/url\(['"]?(.*?)['"]?\)/)[1]}function l(){const K=m();return document.head.insertBefore(K,document.head.firstElementChild),K.sheet}function m(){const K=document.createElement('style');return K.appendChild(document.createTextNode('')),K}function n(K,L=null){return(M,N,O)=>{L=L||M;const Q=K(M,N,O);return new x(Q,L,O)}}function o(K){return Object.assign({},B,K)}function p(K,L,M){const N=1/M,O=K.viewport;return{scale:N,translateX:K.left*(N-1),translateY:((O.height-L.height)*N-(O.height-K.height))/2,translateZ:O.perspective*(1-N)}}const s='data-parallax-element',t=K=>{const L=window.getComputedStyle(K);return j(L.backgroundImage)};var u=function(K,L,M,N){var R,O=arguments.length,Q=3>O?L:null===N?N=Object.getOwnPropertyDescriptor(L,M):N;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(K,L,M,N);else for(var S=K.length-1;0<=S;S--)(R=K[S])&&(Q=(3>O?R(Q):3<O?R(L,M,Q):R(L,M))||Q);return 3<O&&Q&&Object.defineProperty(L,M,Q),Q};class v{constructor(K,L,M){this.style=K,this.width=L,this.height=M,Object.assign(K,{position:'absolute',left:'0',top:'0',transformOrigin:'0 0 0',pointerEvents:'none'})}updateTransform(K){a.autorun(()=>{this.style.transform=`
                translateX(${K.translateX}px)
                translateY(${K.translateY}px)
                translateZ(${K.translateZ}px)
                scale(${K.scale}, ${K.scale})`})}}class w{constructor(K){this.background=K}updateTransform(K){this.background.updateTransform(Object.assign({},K,{scale:K.scale*this.scale}))}get height(){return this.background.height*this.scale}get width(){return this.background.width*this.scale}}u([a.computed],w.prototype,'height',null),u([a.computed],w.prototype,'width',null);class x extends w{constructor(K,L,M){super(K),this.element=L,this.velocityScale=M}get scale(){return Math.max(this.minimalHeight/this.background.height,this.minimalWidth/this.background.width)}get minimalHeight(){const{height:K}=this.element.viewport,{height:L}=this.element,M=1<this.velocityScale?L+(this.velocityScale-1)*(K+L):L+(1-this.velocityScale)*(K-L),N=K+this.velocityScale*(K-L);return Math.max(M,N)}get minimalWidth(){return this.element.width}}u([a.computed],x.prototype,'scale',null),u([a.computed],x.prototype,'minimalHeight',null),u([a.computed],x.prototype,'minimalWidth',null);const y=(K,L)=>{const M=`[${s}="${K.id}"]::before {
        content: '';
        width: ${L.naturalWidth}px;
        height: ${L.naturalHeight}px;
        background-image: url(${L.src});
        background-size: 100% 100%;
    }`,N=A.insertRule(M,0),O=A.cssRules[N].style;return new v(O,L.naturalWidth,L.naturalHeight)},A=function(){const K=m();return document.head.appendChild(K),K.sheet}(),B={velocityScale:0.8,translateX:0,translateY:0,backgroundImage:t,createBackground:n(y)};var C=function(K,L,M,N){var R,O=arguments.length,Q=3>O?L:null===N?N=Object.getOwnPropertyDescriptor(L,M):N;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(K,L,M,N);else for(var S=K.length-1;0<=S;S--)(R=K[S])&&(Q=(3>O?R(Q):3<O?R(L,M,Q):R(L,M))||Q);return 3<O&&Q&&Object.defineProperty(L,M,Q),Q};class D{constructor(K){const L=()=>{this.update(K.getBoundingClientRect()),window.requestAnimationFrame(L)};L()}update(K){for(let L of['bottom','height','left','right','top','width'])this[L]=K[L]}}C([a.observable],D.prototype,'bottom',void 0),C([a.observable],D.prototype,'height',void 0),C([a.observable],D.prototype,'left',void 0),C([a.observable],D.prototype,'right',void 0),C([a.observable],D.prototype,'top',void 0),C([a.observable],D.prototype,'width',void 0),C([a.action],D.prototype,'update',null);class F{constructor(K,L){Object.assign(K.style,{overflowY:'scroll',transformStyle:'flat',perspective:L+'px',perspectiveOrigin:'0 0'}),this.element=K,this.perspective=L,this.boundingClientRect=new D(K)}get height(){return this.boundingClientRect.height}}(function(K,L,M,N){var R,O=arguments.length,Q=3>O?L:null===N?N=Object.getOwnPropertyDescriptor(L,M):N;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(K,L,M,N);else for(var S=K.length-1;0<=S;S--)(R=K[S])&&(Q=(3>O?R(Q):3<O?R(L,M,Q):R(L,M))||Q);return 3<O&&Q&&Object.defineProperty(L,M,Q),Q})([a.computed],F.prototype,'height',null);var G=function(K,L,M,N){var R,O=arguments.length,Q=3>O?L:null===N?N=Object.getOwnPropertyDescriptor(L,M):N;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)Q=Reflect.decorate(K,L,M,N);else for(var S=K.length-1;0<=S;S--)(R=K[S])&&(Q=(3>O?R(Q):3<O?R(L,M,Q):R(L,M))||Q);return 3<O&&Q&&Object.defineProperty(L,M,Q),Q};class H{constructor(K,L){this.id=H.getNextId(),this.element=K,this.boundingClientRect=new D(K),this.viewport=L,this.element.setAttribute(s,this.id)}get width(){return this.boundingClientRect.width}get height(){return this.boundingClientRect.height}get left(){return this.boundingClientRect.left}static getNextId(){return`${H.nextId++}`}}H.nextId=0,G([a.computed],H.prototype,'width',null),G([a.computed],H.prototype,'height',null),G([a.computed],H.prototype,'left',null);var I=function(K,L,M,N){return new(M||(M=Promise))(function(O,Q){function R(U){try{T(N.next(U))}catch(V){Q(V)}}function S(U){try{T(N['throw'](U))}catch(V){Q(V)}}function T(U){U.done?O(U.value):new M(function(V){V(U.value)}).then(R,S)}T((N=N.apply(K,L||[])).next())})};(function(){const K=l();K.insertRule(`
        [${s}] > * {
            position: relative;
        }
    `,0),K.insertRule(`
        [${s}] {
            position: relative;
            overflow: hidden;
        }
    `,0)})();class J{constructor(K,L=1e3){this.viewport=new F(b(K),L)}add(K,L={}){const M=o(L);if(0>M.velocityScale)throw new RangeError('velocityScale must be positive');return f(K,this.viewport.element).filter(N=>!N.hasAttribute(s)).map(N=>this.addElement(N,M))}addElement(K,L){return I(this,void 0,void 0,function*(){const M=yield g(K,L.backgroundImage),N=new H(K,this.viewport),O=L.createBackground(N,M,L.velocityScale);a.autorun(()=>{O.updateTransform(p(N,O,L.velocityScale))})})}}J.getCSSBackgroundImage=t,J.pesudoBefore=y,J.insertImg=(K,L)=>{const M=document.createElement('img');return M.height=L.naturalHeight,M.width=L.naturalWidth,M.src=L.src,K.element.insertBefore(M,K.element.firstElementChild),new v(M.style,L.naturalWidth,L.naturalHeight)},J.coverElement=n,window.Parallax=J})(mobx);
