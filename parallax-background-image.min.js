(function(a){'use strict';function b(M,N=document){return'string'==typeof M?N.querySelector(M):M}function f(M,N=document){return M instanceof Element?[M]:Array.isArray(M)?M:('string'==typeof M&&(M=N.querySelectorAll(M)),Array.prototype.slice.call(M))}function g(M){return'function'==typeof M?M:()=>M}function h(M){const N=g(M);return O=>new Promise(Q=>Q(N(O)))}function j(M,N){return h(N)(M).then(k)}function k(M){return new Promise((N,O)=>{const Q=document.createElement('img');Q.onload=R=>{N(R.target)},Q.onerror=R=>{O(R.error)},Q.src=M})}function l(M){return M.match(/url\(['"]?(.*?)['"]?\)/)[1]}function n(){const M=o();return document.head.insertBefore(M,document.head.firstElementChild),M.sheet}function o(){const M=document.createElement('style');return M.appendChild(document.createTextNode('')),M}function p(M,N=null){return(O,Q,R)=>{N=N||O;const S=M(O,Q,R);return new z(S,N,R)}}function q(M){return Object.assign({},D,M)}function s(M,N,O){const Q=1/O,R=M.viewport;return{scale:Q,translateX:M.left*(Q-1),translateY:((R.height-N.height)*Q-(R.height-M.height))/2,translateZ:R.perspective*(1-Q)}}const u='data-parallax-element',v=M=>{const N=window.getComputedStyle(M);return l(N.backgroundImage)};var w=function(M,N,O,Q){var T,R=arguments.length,S=3>R?N:null===Q?Q=Object.getOwnPropertyDescriptor(N,O):Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)S=Reflect.decorate(M,N,O,Q);else for(var U=M.length-1;0<=U;U--)(T=M[U])&&(S=(3>R?T(S):3<R?T(N,O,S):T(N,O))||S);return 3<R&&S&&Object.defineProperty(N,O,S),S};class x{constructor(M,N,O){this.style=M,this.width=N,this.height=O,Object.assign(M,{position:'absolute',left:'0',top:'0',transformOrigin:'0 0 0',pointerEvents:'none'})}updateTransform(M){a.autorun(()=>{this.style.transform=`
                translateX(${M.translateX}px)
                translateY(${M.translateY}px)
                translateZ(${M.translateZ}px)
                scale(${M.scale}, ${M.scale})`})}}class y{constructor(M){this.background=M}updateTransform(M){this.background.updateTransform(Object.assign({},M,{scale:M.scale*this.scale}))}get height(){return this.background.height*this.scale}get width(){return this.background.width*this.scale}}w([a.computed],y.prototype,'height',null),w([a.computed],y.prototype,'width',null);class z extends y{constructor(M,N,O){super(M),this.element=N,this.velocityScale=O}get scale(){return Math.max(this.minimalHeight/this.background.height,this.minimalWidth/this.background.width)}get minimalHeight(){const{height:M}=this.element.viewport,{height:N}=this.element,O=1<this.velocityScale?N+(this.velocityScale-1)*(M+N):N+(1-this.velocityScale)*(M-N),Q=M+this.velocityScale*(M-N);return Math.max(O,Q)}get minimalWidth(){return this.element.width}}w([a.computed],z.prototype,'scale',null),w([a.computed],z.prototype,'minimalHeight',null),w([a.computed],z.prototype,'minimalWidth',null);const A=(M,N)=>{const O=`[${u}="${M.id}"]::before {
        content: '';
        width: ${N.naturalWidth}px;
        height: ${N.naturalHeight}px;
        background-image: url(${N.src});
        background-size: 100% 100%;
    }`,Q=C.insertRule(O,0),R=C.cssRules[Q].style;return new x(R,N.naturalWidth,N.naturalHeight)},C=function(){const M=o();return document.head.appendChild(M),M.sheet}(),D={velocityScale:0.8,backgroundImage:v,createBackground:p(A)};var E=function(M,N,O,Q){var T,R=arguments.length,S=3>R?N:null===Q?Q=Object.getOwnPropertyDescriptor(N,O):Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)S=Reflect.decorate(M,N,O,Q);else for(var U=M.length-1;0<=U;U--)(T=M[U])&&(S=(3>R?T(S):3<R?T(N,O,S):T(N,O))||S);return 3<R&&S&&Object.defineProperty(N,O,S),S};class F{constructor(M){const N=()=>{this.update(M.getBoundingClientRect()),window.requestAnimationFrame(N)};N()}update(M){for(let N of['bottom','height','left','right','top','width'])this[N]=M[N]}}E([a.observable],F.prototype,'bottom',void 0),E([a.observable],F.prototype,'height',void 0),E([a.observable],F.prototype,'left',void 0),E([a.observable],F.prototype,'right',void 0),E([a.observable],F.prototype,'top',void 0),E([a.observable],F.prototype,'width',void 0),E([a.action],F.prototype,'update',null);class H{constructor(M,N){Object.assign(M.style,{overflowY:'scroll',transformStyle:'flat',perspective:N+'px',perspectiveOrigin:'0 0'}),this.element=M,this.perspective=N,this.boundingClientRect=new F(M)}get height(){return this.boundingClientRect.height}}(function(M,N,O,Q){var T,R=arguments.length,S=3>R?N:null===Q?Q=Object.getOwnPropertyDescriptor(N,O):Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)S=Reflect.decorate(M,N,O,Q);else for(var U=M.length-1;0<=U;U--)(T=M[U])&&(S=(3>R?T(S):3<R?T(N,O,S):T(N,O))||S);return 3<R&&S&&Object.defineProperty(N,O,S),S})([a.computed],H.prototype,'height',null);var I=function(M,N,O,Q){var T,R=arguments.length,S=3>R?N:null===Q?Q=Object.getOwnPropertyDescriptor(N,O):Q;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)S=Reflect.decorate(M,N,O,Q);else for(var U=M.length-1;0<=U;U--)(T=M[U])&&(S=(3>R?T(S):3<R?T(N,O,S):T(N,O))||S);return 3<R&&S&&Object.defineProperty(N,O,S),S};class J{constructor(M,N){this.id=J.getNextId(),this.element=M,this.boundingClientRect=new F(M),this.viewport=N,this.element.setAttribute(u,this.id)}get width(){return this.boundingClientRect.width}get height(){return this.boundingClientRect.height}get left(){return this.boundingClientRect.left}static getNextId(){return`${J.nextId++}`}}J.nextId=0,I([a.computed],J.prototype,'width',null),I([a.computed],J.prototype,'height',null),I([a.computed],J.prototype,'left',null);var K=function(M,N,O,Q){return new(O||(O=Promise))(function(R,S){function T(W){try{V(Q.next(W))}catch(X){S(X)}}function U(W){try{V(Q['throw'](W))}catch(X){S(X)}}function V(W){W.done?R(W.value):new O(function(X){X(W.value)}).then(T,U)}V((Q=Q.apply(M,N||[])).next())})};(function(){const M=n();M.insertRule(`
        [${u}] > * {
            position: relative;
        }
    `,0),M.insertRule(`
        [${u}] {
            position: relative;
            overflow: hidden;
        }
    `,0)})();class L{constructor(M,N=1e3){this.viewport=new H(b(M),N)}add(M,N={}){const O=q(N);if(0>O.velocityScale)throw new RangeError('velocityScale must be positive');return f(M,this.viewport.element).filter(Q=>!Q.hasAttribute(u)).map(Q=>this.addElement(Q,O))}addElement(M,N){return K(this,void 0,void 0,function*(){const O=yield j(M,N.backgroundImage),Q=new J(M,this.viewport),R=N.createBackground(Q,O,N.velocityScale);a.autorun(()=>{R.updateTransform(s(Q,R,N.velocityScale))})})}}L.getCSSBackgroundImage=v,L.pesudoBefore=A,L.insertImg=(M,N)=>{const O=document.createElement('img');return O.height=N.naturalHeight,O.width=N.naturalWidth,O.src=N.src,M.element.insertBefore(O,M.element.firstElementChild),new x(O.style,N.naturalWidth,N.naturalHeight)},L.coverElement=p,window.Parallax=L})(mobx);
