(function(a){'use strict';function b(N,O=document){return'string'==typeof N?O.querySelector(N):N}function f(N,O=document){return N instanceof Element?[N]:Array.isArray(N)?N:('string'==typeof N&&(N=O.querySelectorAll(N)),Array.prototype.slice.call(N))}function g(N){return'function'==typeof N?N:()=>N}function h(N){const O=g(N);return Q=>new Promise(R=>R(O(Q)))}function j(N,O){return h(O)(N).then(k)}function k(N){return new Promise((O,Q)=>{const R=document.createElement('img');R.onload=S=>{O(S.target)},R.onerror=S=>{Q(S.error)},R.src=N})}function l(N){return N.match(/url\(['"]?(.*?)['"]?\)/)[1]}function n(){const N=o();return document.head.insertBefore(N,document.head.firstElementChild),N.sheet}function o(){const N=document.createElement('style');return N.appendChild(document.createTextNode('')),N}function p(N,O=null){return(Q,R,S)=>{O=O||Q;const T=N(Q,R,S);return new A(T,O,S)}}function q(N){return Object.assign({},E,N)}function s(N,O,Q){const R=1/Q,S=N.viewport;return{scale:R,translateX:N.left*(R-1),translateY:((S.height-O.height)*R-(S.height-N.height))/2,translateZ:S.perspective*(1-R)}}function t(N,O,Q){const R=N.viewport,S=R.top+R.height/2,T=N.top+N.height/2,U=N.top+O.height/2;return{scale:1,translateX:0,translateY:(T-S)*(Q-1)-(U-T),translateZ:0}}const v='data-parallax-element',w=N=>{const O=window.getComputedStyle(N);return l(O.backgroundImage)};var x=function(N,O,Q,R){var U,S=arguments.length,T=3>S?O:null===R?R=Object.getOwnPropertyDescriptor(O,Q):R;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)T=Reflect.decorate(N,O,Q,R);else for(var V=N.length-1;0<=V;V--)(U=N[V])&&(T=(3>S?U(T):3<S?U(O,Q,T):U(O,Q))||T);return 3<S&&T&&Object.defineProperty(O,Q,T),T};class y{constructor(N,O,Q){this.style=N,this.width=O,this.height=Q,Object.assign(N,{position:'absolute',left:'0',top:'0',transformOrigin:'0 0 0',pointerEvents:'none'})}updateTransform(N){a.autorun(()=>{this.style.transform=`
                translateX(${N.translateX}px)
                translateY(${N.translateY}px)
                translateZ(${N.translateZ}px)
                scale(${N.scale}, ${N.scale})`})}}class z{constructor(N){this.background=N}updateTransform(N){this.background.updateTransform(Object.assign({},N,{scale:N.scale*this.scale}))}get height(){return this.background.height*this.scale}get width(){return this.background.width*this.scale}}x([a.computed],z.prototype,'height',null),x([a.computed],z.prototype,'width',null);class A extends z{constructor(N,O,Q){super(N),this.element=O,this.velocityScale=Q}get scale(){return Math.max(this.minimalHeight/this.background.height,this.minimalWidth/this.background.width)}get minimalHeight(){const{height:N}=this.element.viewport,{height:O}=this.element,Q=1<this.velocityScale?O+(this.velocityScale-1)*(N+O):O+(1-this.velocityScale)*(N-O),R=N+this.velocityScale*(N-O);return Math.max(Q,R)}get minimalWidth(){return this.element.width}}x([a.computed],A.prototype,'scale',null),x([a.computed],A.prototype,'minimalHeight',null),x([a.computed],A.prototype,'minimalWidth',null);const B=(N,O)=>{const Q=`[${v}="${N.id}"]::before {
        content: '';
        width: ${O.naturalWidth}px;
        height: ${O.naturalHeight}px;
        background-image: url(${O.src});
        background-size: 100% 100%;
    }`,R=D.insertRule(Q,0),S=D.cssRules[R].style;return new y(S,O.naturalWidth,O.naturalHeight)},D=function(){const N=o();return document.head.appendChild(N),N.sheet}(),E={velocityScale:0.8,backgroundImage:w,createBackground:p(B)};var F=function(N,O,Q,R){var U,S=arguments.length,T=3>S?O:null===R?R=Object.getOwnPropertyDescriptor(O,Q):R;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)T=Reflect.decorate(N,O,Q,R);else for(var V=N.length-1;0<=V;V--)(U=N[V])&&(T=(3>S?U(T):3<S?U(O,Q,T):U(O,Q))||T);return 3<S&&T&&Object.defineProperty(O,Q,T),T};class G{constructor(N){const O=()=>{this.update(N.getBoundingClientRect()),window.requestAnimationFrame(O)};O()}update(N){for(let O of['bottom','height','left','right','top','width'])this[O]=N[O]}}F([a.observable],G.prototype,'bottom',void 0),F([a.observable],G.prototype,'height',void 0),F([a.observable],G.prototype,'left',void 0),F([a.observable],G.prototype,'right',void 0),F([a.observable],G.prototype,'top',void 0),F([a.observable],G.prototype,'width',void 0),F([a.action],G.prototype,'update',null);var H=function(N,O,Q,R){var U,S=arguments.length,T=3>S?O:null===R?R=Object.getOwnPropertyDescriptor(O,Q):R;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)T=Reflect.decorate(N,O,Q,R);else for(var V=N.length-1;0<=V;V--)(U=N[V])&&(T=(3>S?U(T):3<S?U(O,Q,T):U(O,Q))||T);return 3<S&&T&&Object.defineProperty(O,Q,T),T};class I{constructor(N,O){Object.assign(N.style,{overflowY:'scroll',transformStyle:'flat',perspective:O+'px',perspectiveOrigin:'0 0'}),this.element=N,this.perspective=O,this.boundingClientRect=new G(N)}get height(){return this.boundingClientRect.height}get top(){return this.boundingClientRect.top}}H([a.computed],I.prototype,'height',null),H([a.computed],I.prototype,'top',null);var J=function(N,O,Q,R){var U,S=arguments.length,T=3>S?O:null===R?R=Object.getOwnPropertyDescriptor(O,Q):R;if('object'==typeof Reflect&&'function'==typeof Reflect.decorate)T=Reflect.decorate(N,O,Q,R);else for(var V=N.length-1;0<=V;V--)(U=N[V])&&(T=(3>S?U(T):3<S?U(O,Q,T):U(O,Q))||T);return 3<S&&T&&Object.defineProperty(O,Q,T),T};class K{constructor(N,O){this.id=K.getNextId(),this.element=N,this.boundingClientRect=new G(N),this.viewport=O,this.element.setAttribute(v,this.id)}get width(){return this.boundingClientRect.width}get height(){return this.boundingClientRect.height}get left(){return this.boundingClientRect.left}get top(){return this.boundingClientRect.top}static getNextId(){return`${K.nextId++}`}}K.nextId=0,J([a.computed],K.prototype,'width',null),J([a.computed],K.prototype,'height',null),J([a.computed],K.prototype,'left',null),J([a.computed],K.prototype,'top',null);var L=function(N,O,Q,R){return new(Q||(Q=Promise))(function(S,T){function U(X){try{W(R.next(X))}catch(Y){T(Y)}}function V(X){try{W(R['throw'](X))}catch(Y){T(Y)}}function W(X){X.done?S(X.value):new Q(function(Y){Y(X.value)}).then(U,V)}W((R=R.apply(N,O||[])).next())})};(function(){const N=n();N.insertRule(`
        [${v}] > * {
            position: relative;
        }
    `,0),N.insertRule(`
        [${v}] {
            position: relative;
            overflow: hidden;
        }
    `,0)})();class M{constructor(N,O=!1,Q=1e3){O&&(Q=0),this.useFallback=O,this.viewport=new I(b(N),Q)}add(N,O={}){const Q=q(O);if(0>Q.velocityScale)throw new RangeError('velocityScale must be positive');return f(N,this.viewport.element).filter(R=>!R.hasAttribute(v)).map(R=>this.addElement(R,Q))}addElement(N,O){return L(this,void 0,void 0,function*(){const Q=yield j(N,O.backgroundImage),R=new K(N,this.viewport),S=O.createBackground(R,Q,O.velocityScale),T=this.useFallback?t:s;a.autorun(()=>{S.updateTransform(T(R,S,O.velocityScale))})})}}M.getCSSBackgroundImage=w,M.pesudoBefore=B,M.insertImg=(N,O)=>{const Q=document.createElement('img');return Q.height=O.naturalHeight,Q.width=O.naturalWidth,Q.src=O.src,N.element.insertBefore(Q,N.element.firstElementChild),new y(Q.style,O.naturalWidth,O.naturalHeight)},M.coverElement=p,window.Parallax=M})(mobx);
